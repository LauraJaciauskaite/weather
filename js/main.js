document.addEventListener('DOMContentLoaded', () => {
    const iconMap = {
        clear: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#FFCD57" d="M27.6,13.9c1,0,1.8-0.8,1.8-1.8v-4c0-1-0.8-1.8-1.8-1.8c-1,0-1.8,0.8-1.8,1.8l0,4 C25.8,13.1,26.6,13.9,27.6,13.9z"/><path fill="#FFCD57" d="M15.6,17.8c0.7,0.7,1.9,0.7,2.6,0c0.7-0.7,0.7-1.8,0-2.6l-2.8-2.8c-0.7-0.7-1.9-0.7-2.6,0 c-0.7,0.7-0.7,1.9,0,2.6L15.6,17.8z"/><path fill="#FFCD57" d="M8.4,28.5h4c1,0,1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.8-1.8h-4c-1,0-1.8,0.8-1.8,1.8C6.6,27.7,7.4,28.5,8.4,28.5z"/><path fill="#FFCD57" d="M15.6,36.7l-2.8,2.8c-0.7,0.7-0.7,1.9,0,2.6c0.7,0.7,1.8,0.7,2.6,0l2.8-2.8c0.7-0.7,0.7-1.9,0-2.6 C17.4,36,16.3,36,15.6,36.7z"/><path fill="#FFCD57" d="M25.8,41.9v4c0,1,0.8,1.8,1.8,1.8c1,0,1.8-0.8,1.8-1.8v-4c0-1-0.8-1.8-1.8-1.8 C26.6,40.1,25.8,40.9,25.8,41.9z"/><path fill="#FFCD57" d="M37,36.8c-0.7,0.7-0.7,1.9,0,2.6l2.8,2.8c0.7,0.7,1.8,0.7,2.6,0c0.7-0.7,0.7-1.9,0-2.6l-2.8-2.8 C38.9,36.1,37.8,36.1,37,36.8z"/><path fill="#FFCD57" d="M39.8,27.3c0,1,0.8,1.8,1.8,1.8l4,0c1,0,1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.8-1.8l-4,0 C40.6,25.5,39.8,26.3,39.8,27.3z"/><path fill="#FFCD57" d="M39.6,17.9l2.8-2.8c0.7-0.7,0.7-1.9,0-2.6c-0.7-0.7-1.8-0.7-2.6,0l-2.8,2.8c-0.7,0.7-0.7,1.8,0,2.6 C37.8,18.6,38.9,18.6,39.6,17.9z"/><path fill="#FFCD57" d="M27.6,38.6c6.2,0,11.2-5,11.2-11.2c0-6.2-5-11.2-11.2-11.2c-6.2,0-11.2,5-11.2,11.2 C16.4,33.5,21.4,38.6,27.6,38.6z M27.6,19.7c4.2,0,7.6,3.4,7.6,7.7S31.9,35,27.6,35c-4.2,0-7.6-3.4-7.6-7.6S23.4,19.7,27.6,19.7z"/></svg>',
        fog: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#498CE8" d="M14.7,30.4c0-1.1-0.9-1.9-1.9-1.9H5.7c-1.1,0-1.9,0.9-1.9,1.9c0,1.1,0.9,1.9,1.9,1.9l7.1,0 C13.9,32.3,14.7,31.4,14.7,30.4z"/><path fill="#498CE8" d="M19.9,32.3l7.1,0c1.1,0,1.9-0.9,1.9-1.9c0-1.1-0.9-1.9-1.9-1.9h-7.1c-1.1,0-1.9,0.9-1.9,1.9 C18,31.4,18.9,32.3,19.9,32.3z"/><path fill="#498CE8" d="M32.2,30.4c0,1.1,0.9,1.9,1.9,1.9l7.1,0c1.1,0,1.9-0.9,1.9-1.9c0-1.1-0.9-1.9-1.9-1.9h-7.1 C33.1,28.5,32.2,29.3,32.2,30.4z"/><path fill="#498CE8" d="M14.7,16.9c0-1.1-0.9-1.9-1.9-1.9H5.7c-1.1,0-1.9,0.9-1.9,1.9c0,1.1,0.9,1.9,1.9,1.9l7.1,0 C13.9,18.8,14.7,17.9,14.7,16.9z"/><path fill="#498CE8" d="M18,16.9c0,1.1,0.9,1.9,1.9,1.9l7.1,0c1.1,0,1.9-0.9,1.9-1.9c0-1.1-0.9-1.9-1.9-1.9h-7.1 C18.9,14.9,18,15.8,18,16.9z"/><path fill="#498CE8" d="M43.1,16.9c0-1.1-0.9-1.9-1.9-1.9h-7.1c-1.1,0-1.9,0.9-1.9,1.9c0,1.1,0.9,1.9,1.9,1.9l7.1,0 C42.3,18.8,43.1,17.9,43.1,16.9z"/><path fill="#498CE8" d="M19.9,35.2h-7.1c-1.1,0-1.9,0.9-1.9,1.9c0,1.1,0.9,1.9,1.9,1.9l7.1,0c1.1,0,1.9-0.9,1.9-1.9 C21.8,36.1,20.9,35.2,19.9,35.2z"/><path fill="#498CE8" d="M34.1,35.2H27c-1.1,0-1.9,0.9-1.9,1.9c0,1.1,0.9,1.9,1.9,1.9l7.1,0c1.1,0,1.9-0.9,1.9-1.9 C36,36.1,35.1,35.2,34.1,35.2z"/><path fill="#498CE8" d="M48.3,35.2h-7.1c-1.1,0-1.9,0.9-1.9,1.9c0,1.1,0.9,1.9,1.9,1.9l7.1,0c1.1,0,1.9-0.9,1.9-1.9 C50.2,36.1,49.3,35.2,48.3,35.2z"/><path fill="#498CE8" d="M12.8,25.5l7.1,0c1.1,0,1.9-0.9,1.9-1.9c0-1.1-0.9-1.9-1.9-1.9h-7.1c-1.1,0-1.9,0.9-1.9,1.9 C10.9,24.7,11.7,25.5,12.8,25.5z"/><path fill="#498CE8" d="M34.1,21.7H27c-1.1,0-1.9,0.9-1.9,1.9c0,1.1,0.9,1.9,1.9,1.9l7.1,0c1.1,0,1.9-0.9,1.9-1.9 C36,22.6,35.1,21.7,34.1,21.7z"/><path fill="#498CE8" d="M48.3,21.7h-7.1c-1.1,0-1.9,0.9-1.9,1.9c0,1.1,0.9,1.9,1.9,1.9l7.1,0c1.1,0,1.9-0.9,1.9-1.9 C50.2,22.6,49.3,21.7,48.3,21.7z"/></svg>',
        'heavy-rain': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#498CE8" d="M8.7,18.3c-2.2,1.4-3.5,3.8-3.5,6.4c0,2,0.8,3.9,2.2,5.3c0.6,0.6,1.6,0.6,2.2,0c0.6-0.6,0.6-1.6,0-2.2 c-0.8-0.8-1.3-1.9-1.3-3.1c0-1.7,1-3.3,2.6-4l0.9-0.4l0-1c0.1-5.3,4.5-9.6,9.7-9.6c2.6,0,5,1,6.9,2.9l0.6,0.6l0.8-0.2 c0.4-0.1,0.9-0.1,1.4-0.1c3.5,0,6.5,2.8,6.8,6.3l0.2,2l1.9-0.6c0.4-0.1,0.9-0.2,1.3-0.2c2.4,0,4.4,2,4.4,4.4c0,1.2-0.5,2.3-1.3,3.1 c-0.6,0.6-0.6,1.6,0,2.2c0.3,0.3,0.7,0.5,1.1,0.5c0.4,0,0.8-0.2,1.1-0.5c1.4-1.4,2.2-3.3,2.2-5.3c0-4.2-3.4-7.5-7.5-7.5 c-0.2,0-0.4,0-0.6,0c-1.1-4.3-5.1-7.4-9.6-7.4c-0.4,0-0.8,0-1.2,0.1c-2.4-2.1-5.3-3.2-8.5-3.2C14.8,6.5,9.3,11.7,8.7,18.3z"/><path fill="#91BBEA" d="M23.4,29.2c0.7-1.1,0.3-2.6-0.9-3.3c-1.1-0.7-2.6-0.3-3.3,0.9l-2.6,4.6c-0.7,1.1-0.3,2.6,0.9,3.3 c1.1,0.7,2.6,0.3,3.3-0.9L23.4,29.2z"/><path fill="#91BBEA" d="M33.8,26c-1.1-0.7-2.6-0.3-3.3,0.9l-2.7,4.6c-0.7,1.1-0.3,2.6,0.9,3.3c1.1,0.7,2.6,0.3,3.3-0.9l2.7-4.6 C35.3,28.1,34.9,26.6,33.8,26z"/><path fill="#91BBEA" d="M21.5,47.1c1.1,0.7,2.6,0.3,3.3-0.9l2.7-4.6c0.7-1.1,0.3-2.6-0.9-3.3c-1.1-0.7-2.6-0.3-3.3,0.9l-2.7,4.6 C20,45,20.4,46.5,21.5,47.1z"/></svg>',
        'heavy-snow': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#91BBEA" d="M30.9,39.8c-0.3-0.6-1.1-0.8-1.6-0.4l-1.7,1v-1.9c0-0.7-0.5-1.2-1.2-1.2s-1.2,0.5-1.2,1.2v1.9l-1.7-1 c-0.6-0.3-1.3-0.1-1.6,0.4c-0.3,0.6-0.1,1.3,0.4,1.6l1.7,1l-1.7,1c-0.6,0.3-0.8,1.1-0.4,1.6c0.3,0.6,1.1,0.8,1.6,0.4l1.7-1v1.9 c0,0.7,0.5,1.2,1.2,1.2s1.2-0.5,1.2-1.2v-1.9l1.7,1c0.6,0.3,1.3,0.1,1.6-0.4c0.3-0.6,0.1-1.3-0.4-1.6l-1.7-1l1.7-1 C31.1,41.1,31.3,40.4,30.9,39.8z"/><path fill="#91BBEA" d="M38.2,28.7c-0.3-0.6-1.1-0.8-1.6-0.4l-1.7,1v-1.9c0-0.7-0.5-1.2-1.2-1.2c-0.7,0-1.2,0.5-1.2,1.2v1.9l-1.7-1 c-0.6-0.3-1.3-0.1-1.6,0.4c-0.3,0.6-0.1,1.3,0.4,1.6l1.7,1l-1.7,1c-0.6,0.3-0.8,1.1-0.4,1.6c0.3,0.6,1.1,0.8,1.6,0.4l1.7-1v1.9 c0,0.7,0.5,1.2,1.2,1.2c0.7,0,1.2-0.5,1.2-1.2v-1.9l1.7,1c0.6,0.3,1.3,0.1,1.6-0.4c0.3-0.6,0.1-1.3-0.4-1.6l-1.7-1l1.7-1 C38.3,30,38.5,29.3,38.2,28.7z"/><path fill="#91BBEA" d="M23.5,33.9c0.3-0.6,0.1-1.3-0.4-1.6l-1.7-1l1.7-1c0.6-0.3,0.8-1.1,0.4-1.6c-0.3-0.6-1.1-0.8-1.6-0.4l-1.7,1 v-1.9c0-0.7-0.5-1.2-1.2-1.2c-0.7,0-1.2,0.5-1.2,1.2v1.9l-1.7-1c-0.6-0.3-1.3-0.1-1.6,0.4c-0.3,0.6-0.1,1.3,0.4,1.6l1.7,1l-1.7,1 c-0.6,0.3-0.8,1.1-0.4,1.6c0.3,0.6,1.1,0.8,1.6,0.4l1.7-1v1.9c0,0.7,0.5,1.2,1.2,1.2c0.7,0,1.2-0.5,1.2-1.2v-1.9l1.7,1 C22.4,34.7,23.2,34.5,23.5,33.9z"/><path fill="#498CE8" d="M41.3,16.9c-0.2,0-0.4,0-0.6,0c-1.1-4.3-5.1-7.4-9.6-7.4c-0.4,0-0.8,0-1.2,0.1c-2.4-2.1-5.3-3.2-8.5-3.2 c-6.7,0-12.2,5.2-12.8,11.7c-2.2,1.4-3.5,3.8-3.5,6.4c0,2,0.8,3.9,2.2,5.3c0.6,0.6,1.6,0.6,2.2,0c0.6-0.6,0.6-1.6,0-2.2 c-0.8-0.8-1.3-1.9-1.3-3.1c0-1.7,1-3.3,2.6-4l0.9-0.4l0-1c0.1-5.3,4.5-9.6,9.7-9.6c2.6,0,5,1,6.9,2.9L29,13l0.8-0.2 c0.4-0.1,0.9-0.1,1.4-0.1c3.5,0,6.5,2.8,6.8,6.3l0.2,2l1.9-0.6c0.4-0.1,0.9-0.2,1.3-0.2c2.4,0,4.4,2,4.4,4.4c0,1.2-0.5,2.3-1.3,3.1 c-0.6,0.6-0.6,1.6,0,2.2c0.3,0.3,0.7,0.5,1.1,0.5c0.4,0,0.8-0.2,1.1-0.5c1.4-1.4,2.2-3.3,2.2-5.3C48.9,20.3,45.5,16.9,41.3,16.9z"/></svg>',
        'isolated-clouds': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#498CE8" d="M10.6,45.8h19.5c1.5,0,3-0.6,4-1.7c0.6-0.6,0.6-1.7,0-2.3c-0.6-0.6-1.7-0.6-2.3,0c-0.5,0.5-1.1,0.7-1.7,0.7 H10.6c-1.3,0-2.4-1.1-2.4-2.4c0-0.9,0.6-1.8,1.4-2.2l0.9-0.4l0-1c0.1-3.3,2.8-5.9,6-5.9c0.9,0,1.7-0.7,1.7-1.6s-0.7-1.6-1.7-1.6 c-4.7,0-8.7,3.6-9.3,8.2c-1.5,1.1-2.4,2.8-2.4,4.7C4.9,43.3,7.5,45.8,10.6,45.8z"/><path fill="#FFCD57" d="M33.4,32.5c4.7,0,8.6-3.9,8.6-8.6s-3.9-8.6-8.6-8.6s-8.6,3.9-8.6,8.6S28.6,32.5,33.4,32.5z M33.4,18.4 c3,0,5.5,2.5,5.5,5.5s-2.5,5.5-5.5,5.5s-5.5-2.5-5.5-5.5S30.3,18.4,33.4,18.4z"/><path fill="#FFCD57" d="M33.4,14.3c0.9,0,1.5-0.7,1.5-1.5v-3c0-0.9-0.7-1.5-1.5-1.5s-1.5,0.7-1.5,1.5v3 C31.8,13.6,32.5,14.3,33.4,14.3z"/><path fill="#FFCD57" d="M31.8,35v3c0,0.9,0.7,1.5,1.5,1.5s1.5-0.7,1.5-1.5v-3c0-0.9-0.7-1.5-1.5-1.5S31.8,34.2,31.8,35z"/><path fill="#FFCD57" d="M43,23.9c0,0.9,0.7,1.5,1.5,1.5h3c0.9,0,1.5-0.7,1.5-1.5s-0.7-1.5-1.5-1.5h-3C43.7,22.3,43,23,43,23.9z"/><path fill="#FFCD57" d="M19.2,25.4h3c0.9,0,1.5-0.7,1.5-1.5s-0.7-1.5-1.5-1.5h-3c-0.9,0-1.5,0.7-1.5,1.5S18.3,25.4,19.2,25.4z"/><path fill="#FFCD57" d="M41.3,17.5c0.4,0,0.8-0.2,1.1-0.5l2.1-2.1c0.6-0.6,0.6-1.6,0-2.2c-0.6-0.6-1.6-0.6-2.2,0l-2.1,2.1 c-0.6,0.6-0.6,1.6,0,2.2C40.5,17.4,40.9,17.5,41.3,17.5z"/><path fill="#FFCD57" d="M24.4,30.7l-2.1,2.1c-0.6,0.6-0.6,1.6,0,2.2c0.3,0.3,0.7,0.5,1.1,0.5s0.8-0.2,1.1-0.5l2.1-2.1 c0.6-0.6,0.6-1.6,0-2.2C26,30.1,25,30.1,24.4,30.7z"/><path fill="#FFCD57" d="M42.3,30.7c-0.6-0.6-1.6-0.6-2.2,0c-0.6,0.6-0.6,1.6,0,2.2l2.1,2.1c0.3,0.3,0.7,0.5,1.1,0.5 s0.8-0.2,1.1-0.5c0.6-0.6,0.6-1.6,0-2.2L42.3,30.7z"/><path fill="#FFCD57" d="M24.4,17.1c0.3,0.3,0.7,0.5,1.1,0.5s0.8-0.2,1.1-0.5c0.6-0.6,0.6-1.6,0-2.2l-2.1-2.1 c-0.6-0.6-1.6-0.6-2.2,0c-0.6,0.6-0.6,1.6,0,2.2L24.4,17.1z"/></svg>',
        'light-rain': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#498CE8" d="M41.3,25.3c-0.2,0-0.4,0-0.6,0c-1.1-4.3-5.1-7.4-9.6-7.4c-0.4,0-0.8,0-1.2,0.1c-2.4-2.1-5.3-3.2-8.5-3.2 c-6.7,0-12.2,5.2-12.8,11.7c-2.2,1.4-3.5,3.8-3.5,6.4c0,2,0.8,3.9,2.2,5.3c0.6,0.6,1.6,0.6,2.2,0c0.6-0.6,0.6-1.6,0-2.2 c-0.8-0.8-1.3-1.9-1.3-3.1c0-1.7,1-3.3,2.6-4l0.9-0.4l0-1c0.1-5.3,4.5-9.6,9.7-9.6c2.6,0,5,1,6.9,2.9l0.6,0.6l0.8-0.2 c0.4-0.1,0.9-0.1,1.4-0.1c3.5,0,6.5,2.8,6.8,6.3l0.2,2l1.9-0.6c0.4-0.1,0.9-0.2,1.3-0.2c2.4,0,4.4,2,4.4,4.4c0,1.2-0.5,2.3-1.3,3.1 c-0.6,0.6-0.6,1.6,0,2.2c0.3,0.3,0.7,0.5,1.1,0.5c0.4,0,0.8-0.2,1.1-0.5c1.4-1.4,2.2-3.3,2.2-5.3C48.9,28.7,45.5,25.3,41.3,25.3z"/><path fill="#91BBEA" d="M25.9,42.8l2.7-4.6c0.7-1.1,0.3-2.6-0.9-3.3c-1.1-0.7-2.6-0.3-3.3,0.9l-2.6,4.6c-0.7,1.1-0.3,2.6,0.9,3.3 C23.8,44.3,25.3,44,25.9,42.8z"/></svg>',
        'light-snow': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#498CE8" d="M41.3,26.7c-0.2,0-0.4,0-0.6,0c-1.1-4.3-5.1-7.4-9.6-7.4c-0.4,0-0.8,0-1.2,0.1c-2.4-2.1-5.3-3.2-8.5-3.2 c-6.7,0-12.2,5.2-12.8,11.7c-2.2,1.4-3.5,3.8-3.5,6.4c0,2,0.8,3.9,2.2,5.3c0.6,0.6,1.6,0.6,2.2,0c0.6-0.6,0.6-1.6,0-2.2 c-0.8-0.8-1.3-1.9-1.3-3.1c0-1.7,1-3.3,2.6-4l0.9-0.4l0-1c0.1-5.3,4.5-9.6,9.7-9.6c2.6,0,5,1,6.9,2.9l0.6,0.6l0.8-0.2 c0.4-0.1,0.9-0.1,1.4-0.1c3.5,0,6.5,2.8,6.8,6.3l0.2,2l1.9-0.6c0.4-0.1,0.9-0.2,1.3-0.2c2.4,0,4.4,2,4.4,4.4c0,1.2-0.5,2.3-1.3,3.1 c-0.6,0.6-0.6,1.6,0,2.2c0.3,0.3,0.7,0.5,1.1,0.5c0.4,0,0.8-0.2,1.1-0.5c1.4-1.4,2.2-3.3,2.2-5.3C48.9,30.1,45.5,26.7,41.3,26.7z"/><path fill="#91BBEA" d="M31.2,37.7c-0.3-0.6-1.1-0.8-1.6-0.4l-1.7,1v-1.9c0-0.7-0.5-1.2-1.2-1.2c-0.7,0-1.2,0.5-1.2,1.2v1.9l-1.7-1 c-0.6-0.3-1.3-0.1-1.6,0.4c-0.3,0.6-0.1,1.3,0.4,1.6l1.7,1l-1.7,1c-0.6,0.3-0.8,1.1-0.4,1.6c0.3,0.6,1.1,0.8,1.6,0.4l1.7-1v1.9 c0,0.7,0.5,1.2,1.2,1.2c0.7,0,1.2-0.5,1.2-1.2v-1.9l1.7,1c0.6,0.3,1.3,0.1,1.6-0.4c0.3-0.6,0.1-1.3-0.4-1.6l-1.7-1l1.7-1 C31.3,39,31.5,38.3,31.2,37.7z"/></svg>',
        'moderate-rain': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#498CE8" d="M41.3,25.3c-0.2,0-0.4,0-0.6,0c-1.1-4.3-5.1-7.4-9.6-7.4c-0.4,0-0.8,0-1.2,0.1c-2.4-2.1-5.3-3.2-8.5-3.2 c-6.7,0-12.2,5.2-12.8,11.7c-2.2,1.4-3.5,3.8-3.5,6.4c0,2,0.8,3.9,2.2,5.3c0.6,0.6,1.6,0.6,2.2,0c0.6-0.6,0.6-1.6,0-2.2 c-0.8-0.8-1.3-1.9-1.3-3.1c0-1.7,1-3.3,2.6-4l0.9-0.4l0-1c0.1-5.3,4.5-9.6,9.7-9.6c2.6,0,5,1,6.9,2.9l0.6,0.6l0.8-0.2 c0.4-0.1,0.9-0.1,1.4-0.1c3.5,0,6.5,2.8,6.8,6.3l0.2,2l1.9-0.6c0.4-0.1,0.9-0.2,1.3-0.2c2.4,0,4.4,2,4.4,4.4c0,1.2-0.5,2.3-1.3,3.1 c-0.6,0.6-0.6,1.6,0,2.2c0.3,0.3,0.7,0.5,1.1,0.5c0.4,0,0.8-0.2,1.1-0.5c1.4-1.4,2.2-3.3,2.2-5.3C48.9,28.7,45.5,25.3,41.3,25.3z"/><path fill="#91BBEA" d="M20.9,42.8l2.7-4.6c0.7-1.1,0.3-2.6-0.9-3.3c-1.1-0.7-2.6-0.3-3.3,0.9l-2.6,4.6c-0.7,1.1-0.3,2.6,0.9,3.3 C18.8,44.3,20.3,44,20.9,42.8z"/><path fill="#91BBEA" d="M32.3,42.8l2.7-4.6c0.7-1.1,0.3-2.6-0.9-3.3c-1.1-0.7-2.6-0.3-3.3,0.9l-2.6,4.6c-0.7,1.1-0.3,2.6,0.9,3.3 C30.2,44.3,31.6,44,32.3,42.8z"/></svg>',
        'moderate-snow': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#498CE8" d="M41.3,26.7c-0.2,0-0.4,0-0.6,0c-1.1-4.3-5.1-7.4-9.6-7.4c-0.4,0-0.8,0-1.2,0.1c-2.4-2.1-5.3-3.2-8.5-3.2 c-6.7,0-12.2,5.2-12.8,11.7c-2.2,1.4-3.5,3.8-3.5,6.4c0,2,0.8,3.9,2.2,5.3c0.6,0.6,1.6,0.6,2.2,0c0.6-0.6,0.6-1.6,0-2.2 c-0.8-0.8-1.3-1.9-1.3-3.1c0-1.7,1-3.3,2.6-4l0.9-0.4l0-1c0.1-5.3,4.5-9.6,9.7-9.6c2.6,0,5,1,6.9,2.9l0.6,0.6l0.8-0.2 c0.4-0.1,0.9-0.1,1.4-0.1c3.5,0,6.5,2.8,6.8,6.3l0.2,2l1.9-0.6c0.4-0.1,0.9-0.2,1.3-0.2c2.4,0,4.4,2,4.4,4.4c0,1.2-0.5,2.3-1.3,3.1 c-0.6,0.6-0.6,1.6,0,2.2c0.3,0.3,0.7,0.5,1.1,0.5c0.4,0,0.8-0.2,1.1-0.5c1.4-1.4,2.2-3.3,2.2-5.3C48.9,30.1,45.5,26.7,41.3,26.7z"/><path fill="#91BBEA" d="M38.2,37.7c-0.3-0.6-1.1-0.8-1.6-0.4l-1.7,1v-1.9c0-0.7-0.5-1.2-1.2-1.2c-0.7,0-1.2,0.5-1.2,1.2v1.9l-1.7-1 c-0.6-0.3-1.3-0.1-1.6,0.4c-0.3,0.6-0.1,1.3,0.4,1.6l1.7,1l-1.7,1c-0.6,0.3-0.8,1.1-0.4,1.6c0.3,0.6,1.1,0.8,1.6,0.4l1.7-1v1.9 c0,0.7,0.5,1.2,1.2,1.2c0.7,0,1.2-0.5,1.2-1.2v-1.9l1.7,1c0.6,0.3,1.3,0.1,1.6-0.4c0.3-0.6,0.1-1.3-0.4-1.6l-1.7-1l1.7-1 C38.3,39,38.5,38.3,38.2,37.7z"/><path fill="#91BBEA" d="M24.7,37.7c-0.3-0.6-1.1-0.8-1.6-0.4l-1.7,1v-1.9c0-0.7-0.5-1.2-1.2-1.2c-0.7,0-1.2,0.5-1.2,1.2v1.9l-1.7-1 c-0.6-0.3-1.3-0.1-1.6,0.4c-0.3,0.6-0.1,1.3,0.4,1.6l1.7,1l-1.7,1c-0.6,0.3-0.8,1.1-0.4,1.6c0.3,0.6,1.1,0.8,1.6,0.4l1.7-1v1.9 c0,0.7,0.5,1.2,1.2,1.2c0.7,0,1.2-0.5,1.2-1.2v-1.9l1.7,1c0.6,0.3,1.3,0.1,1.6-0.4c0.3-0.6,0.1-1.3-0.4-1.6l-1.7-1l1.7-1 C24.8,39,25,38.3,24.7,37.7z"/></svg>',
        overcast: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#498CE8" d="M44,30.7c-0.6-2.3-2.4-5.5-7.6-5.5c-1.4-5.7-5.9-7.1-8.6-7.1l0,0l-2.6-0.6c-2-1.6-5-2.7-7.9-2.7 c-6.8,0-12.3,5.2-12.8,11.9c-2.2,1.3-3.7,3.7-3.7,6.4c0,4.1,3.3,7.4,7.4,7.4h28.6c4.2,0,7.6-3.4,7.6-7.6L44,30.7L44,30.7z M36.7,37.6H8.8C6,37.6,4,35.6,4,33c0-2.1,1.3-4,3.4-4.6c0.2-10,9-10.5,10-10.5c2.9,0,5.8,1.4,7.6,3.5c3.7-1.2,8.9,1.7,8.3,7.2 c1.5-0.6,2.9-0.5,3.3-0.5c2.1,0,4.6,1.8,4.6,4.8C41.3,35.5,39.3,37.6,36.7,37.6z"/><path fill="#91BBEA" d="M47.3,21.4c-1.3-5.4-6.3-5.6-7.7-5.2c-1.5-1.5-4.1-2.6-6.6-2.6c-3.2,0-6,1.5-7.8,3.9l2.6,0.6l0,0 c2.1-2,4.9-2.2,5.3-2.2c2.2,0,4.3,1.1,5.7,2.7c2.8-0.9,6.7,1.2,6.2,5.4c1.1-0.4,2.2-0.4,2.5-0.4c1.6,0,3.5,1.4,3.5,3.6 c0,1.9-1.6,3.5-3.5,3.5H44l0.3,2.1h3.3c3.2,0,5.7-2.6,5.7-5.7C53.3,27.1,53.3,21.4,47.3,21.4z"/></svg>',
        'scattered-clouds': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#FFCD57" d="M33.8,19.6c0.7-0.8,1.8-1.3,3-1.3c2.2,0,4,1.8,4,4c0,1.1-0.4,2.1-1.2,2.8c0.1,0.4,0.3,0.8,0.4,1.2 c0.9,0,1.7,0.1,2.5,0.3c0.9-1.2,1.5-2.7,1.5-4.3c0-4-3.2-7.2-7.2-7.2c-2.8,0-5.3,1.6-6.5,4.1C31.2,19.1,32.4,19.2,33.8,19.6z"/><path fill="#FFCD57" d="M36.8,14.1c0.9,0,1.6-0.7,1.6-1.6V11c0-0.9-0.7-1.6-1.6-1.6s-1.6,0.7-1.6,1.6v1.5 C35.2,13.4,35.9,14.1,36.8,14.1z"/><path fill="#FFCD57" d="M45,22.3c0,0.9,0.7,1.6,1.6,1.6h1.5c0.9,0,1.6-0.7,1.6-1.6s-0.7-1.6-1.6-1.6h-1.5 C45.7,20.7,45,21.4,45,22.3z"/><path fill="#FFCD57" d="M43.7,16.9c0.4,0,0.8-0.2,1.1-0.5l1.1-1.1c0.6-0.6,0.6-1.6,0-2.2c-0.6-0.6-1.6-0.6-2.2,0l-1.1,1.1 c-0.6,0.6-0.6,1.6,0,2.2C42.9,16.8,43.3,16.9,43.7,16.9z"/><path fill="#FFCD57" d="M28.8,16.5c0.3,0.3,0.7,0.5,1.1,0.5s0.8-0.2,1.1-0.5c0.6-0.6,0.6-1.6,0-2.2l-1.1-1.1 c-0.6-0.6-1.6-0.6-2.2,0c-0.6,0.6-0.6,1.6,0,2.2L28.8,16.5z"/><path fill="#498CE8" d="M11.7,41.6h28.7c4.2,0,7.6-3.4,7.6-7.6c0,0,0-6-5.5-7.3c-0.7-0.2-1.5-0.3-2.5-0.3c-0.1-0.4-0.2-0.8-0.4-1.2 c-1.2-3.4-3.7-4.9-5.9-5.6c-1.4-0.4-2.7-0.4-3.5-0.3c-0.2,0-0.4,0.1-0.5,0.1c-2-2-5.4-3.5-8.9-3.5c-6.8,0-12.4,5.3-12.9,11.9 c-2.2,1.3-3.7,3.7-3.7,6.4C4.3,38.3,7.6,41.6,11.7,41.6z M11,29.5c0.3-10,9.1-10.6,10.1-10.6c2.9,0,5.8,1.4,7.7,3.5 c3.8-1.2,8.9,1.7,8.3,7.3c1.5-0.6,2.9-0.5,3.4-0.5c2.1,0,4.7,1.8,4.7,4.9c0,2.6-2.1,4.7-4.7,4.7h-28c-2.8,0-4.8-2-4.8-4.6 C7.6,32,8.9,30.2,11,29.5z"/></svg>',
        sleet: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 54"><path fill="#91BBEA" d="M17.8,34l-2.7,4.6c-0.7,1.1-0.3,2.6,0.9,3.3c1.1,0.7,2.6,0.3,3.3-0.9l2.6-4.6c0.7-1.1,0.3-2.6-0.9-3.3 C20,32.4,18.5,32.8,17.8,34z"/><path fill="#91BBEA" d="M33.7,42.7c0.7,0,1.2-0.5,1.2-1.2v-1.9l1.7,1c0.6,0.3,1.3,0.1,1.6-0.4c0.3-0.6,0.1-1.3-0.4-1.6l-1.7-1 l1.7-1c0.6-0.3,0.8-1.1,0.4-1.6c-0.3-0.6-1.1-0.8-1.6-0.4l-1.7,1v-1.9c0-0.7-0.5-1.2-1.2-1.2c-0.7,0-1.2,0.5-1.2,1.2v1.9l-1.7-1 c-0.6-0.3-1.3-0.1-1.6,0.4c-0.3,0.6-0.1,1.3,0.4,1.6l1.7,1l-1.7,1c-0.6,0.3-0.8,1.1-0.4,1.6c0.3,0.6,1.1,0.8,1.6,0.4l1.7-1v1.9 C32.5,42.2,33,42.7,33.7,42.7z"/><path fill="#498CE8" d="M48.9,29.4c0-4.2-3.4-7.5-7.5-7.5c-0.2,0-0.4,0-0.6,0c-1.1-4.3-5.1-7.4-9.6-7.4c-0.4,0-0.8,0-1.2,0.1 c-2.4-2.1-5.3-3.2-8.5-3.2c-6.7,0-12.2,5.2-12.8,11.7c-2.2,1.4-3.5,3.8-3.5,6.4c0,2,0.8,3.9,2.2,5.3c0.6,0.6,1.6,0.6,2.2,0 c0.6-0.6,0.6-1.6,0-2.2c-0.8-0.8-1.3-1.9-1.3-3.1c0-1.7,1-3.3,2.6-4l0.9-0.4l0-1c0.1-5.3,4.5-9.6,9.7-9.6c2.6,0,5,1,6.9,2.9 l0.6,0.6l0.8-0.2c0.4-0.1,0.9-0.1,1.4-0.1c3.5,0,6.5,2.8,6.8,6.3l0.2,2l1.9-0.6c0.4-0.1,0.9-0.2,1.3-0.2c2.4,0,4.4,2,4.4,4.4 c0,1.2-0.5,2.3-1.3,3.1c-0.6,0.6-0.6,1.6,0,2.2c0.3,0.3,0.7,0.5,1.1,0.5c0.4,0,0.8-0.2,1.1-0.5C48.1,33.3,48.9,31.4,48.9,29.4z"/></svg>',
    };
    const forecastForm = document.querySelector('.forecast-form');
    const placeChoice = document.getElementById('place-choice');
    const placeList = document.getElementById('places');
    const placeOptions = [];
    const forecastLoader = document.querySelector('.forecast-loader');
    const forecastResults = document.querySelector('.forecast-results');
    const localDateFormat = new Intl.DateTimeFormat(undefined, {
        weekday: 'long',
        month: '2-digit',
        day: '2-digit',
    });
    const localTimeFormat = new Intl.DateTimeFormat(undefined, { timeStyle: 'short' });

    fetch('https://cors-anywhere.herokuapp.com/https://api.meteo.lt/v1/places').then(response => response.json()).then(places => {
        places.forEach(({ code, name }) => {
            placeOptions.push({ code, name });

            placeList.appendChild(createOption(name));
        });
    });

    placeChoice.addEventListener('input', () => {
        placeChoice.setCustomValidity('');
    });

    forecastForm.addEventListener('submit', event => {
        event.preventDefault();

        const place = placeOptions.find(o => o.name === placeChoice.value);
        placeChoice.setCustomValidity('');
        forecastResults.innerHTML = '';
        forecastLoader.classList.add('visible');

        if (place) {
            fetch(`https://cors-anywhere.herokuapp.com/https://api.meteo.lt/v1/places/${place.code}/forecasts/long-term`).then(response => response.json()).then(response => {
                const results = groupForecastByDate(response.forecastTimestamps);
                forecastLoader.classList.remove('visible');

                Object.keys(results).forEach(date => {
                    const result = createForecastResult(localDateFormat.format(new Date(date)));
                    const table = createTable();
                    const tbody = createTableBody();
                    table.appendChild(createTableHead());
                    table.appendChild(tbody);

                    results[date].forEach(dateResult => {
                        tbody.appendChild(createTableRow(dateResult));
                    });

                    result.appendChild(table);

                    forecastResults.appendChild(result);
                });
            });
        } else {
            forecastLoader.classList.remove('visible');
            placeChoice.setCustomValidity(`Miestas "${placeChoice.value}" neegzistuoja.`);
            forecastForm.reportValidity();
        }
    });

    function createOption (text) {
        const option = document.createElement('option');
        option.text = text;

        return option;
    }

    function createForecastResult (day) {
        const result = document.createElement('div');
        const title = document.createElement('h2');
        title.textContent = day;
        result.appendChild(title);

        return result;
    }

    function createTable () {
        const table = document.createElement('table');
        table.setAttribute('role', 'table');
        table.classList.add('forecast');

        return table;
    }

    function createTableHead () {
        const tableHead = document.createElement('thead');
        tableHead.setAttribute('role', 'rowgroup');
        const tableRow = document.createElement('tr');
        tableRow.appendChild(createTableHeadRowColumn('Laikas'));
        tableRow.appendChild(createTableHeadRowColumn('Oro temperatūra'));
        tableRow.appendChild(createTableHeadRowColumn('Oro sąlygos'));
        tableHead.appendChild(tableRow);

        return tableHead;
    }

    function createTableBody () {
        const tableBody = document.createElement('tbody');
        tableBody.setAttribute('role', 'rowgroup');

        return tableBody;
    }

    function createTableRow ({ airTemperature, conditionCode, time }) {
        const tableRow = document.createElement('tr');
        tableRow.setAttribute('role', 'row');
        let conditionContent;
        if (iconMap[conditionCode]) {
            conditionContent = `<span>${htmlToElement(iconMap[conditionCode], { height: '18px', width: '18px' }).outerHTML} ${conditionCode}</span>`;
        } else {
            conditionContent = conditionCode;
        }
        tableRow.appendChild(createTableBodyRowColumn(time));
        tableRow.appendChild(createTableBodyRowColumn(airTemperature !== null ? airTemperature + ' °C' : null));
        tableRow.appendChild(createTableBodyRowColumn(conditionContent));
        return tableRow;
    }

    function createTableHeadRowColumn (text) {
        return createTableColumn('th', 'columnheader', text);
    }

    function createTableBodyRowColumn (text) {
        return createTableColumn('td', 'cell', text);
    }

    function createTableColumn (type, role, text) {
        const column = document.createElement(type);
        column.setAttribute('role', role);
        column.innerHTML = text !== null ? text : '-';

        return column;
    }

    function groupForecastByDate (forecastTimestamps) {
        const groups = {};

        forecastTimestamps.forEach(row => {
            const dateParts = row.forecastTimeUtc.split(' ');
            const date = dateParts[0];
            const time = localTimeFormat.format(Date.parse(`${row.forecastTimeUtc} UTC`));

            if (!groups[date]) {
                groups[date] = [];
            }

            groups[date].push({ ...row, time });
        });

        return groups;
    }

    function htmlToElement (html, attributes) {
        var template = document.createElement('template');
        attributes = attributes || {};
        html = html.trim();
        template.innerHTML = html;
        const child = template.content.firstChild;
        Object.keys(attributes).forEach(attribute => {
            child.setAttribute(attribute, attributes[attribute]);
        });

        return child;
    }
});